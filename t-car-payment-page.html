<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../t-image/t-image.html">
<link rel="import" href="../t-shared-lib/t-date-behavior.html">

<dom-module id="t-car-payment-page">
    <template>
        <style include="iron-flex"></style>
        <style include="travel-element-styles">
          :host {
            display: block;
          }
         .dotted-border{
            position: relative;
            margin: -5px var(--normal-spacing,10px) 0;
            border-bottom: 1px dotted;
         }
        </style>
        <t-image sizing="contain" class="imageArea border-bottom" height="120" src="[[itinerary.heroImageUrl]]"></t-image>
        <div class="logo-area font-semi section-small primary-light-text left-section">
          <div class="font-16 item">[[itinerary.name]]</div>
          <div class="font-12 item">[[itinerary.category]]</div>
          <img src$="[[itinerary.brand.logo]]" alt$="[[itinerary.brand.name]]" class="item" />
        </div>
        <div class="section-small secondary-text">
            <template is="dom-if" if="[[itinerary.pickupInfo.inTerminal]]">
                <div class="font-12 margin-bottom">In terminal - [[itinerary.pickupInfo.completeAddress.city]]</div>
            </template>
            <div class="icons-area flex layout horizontal font-10">
                <template is="dom-if" if="[[_checkIfNotSpecified(itinerary.capacity)]]">
                    <div class="icon-item">
                        <iron-icon icon="car:seat"></iron-icon>
                        <span class="text">[[itinerary.capacity]]</span>
                    </div>
                </template>

                <div class="icon-item">
                    <iron-icon icon="car:luggage"></iron-icon>
                    <span class="text">[[itinerary.baggage]]</span>
                </div>

                <div class="icon-item">
                    <iron-icon icon="car:gear"></iron-icon>
                    <span class="text">[[gear]]</span>
                </div>

                <template is="dom-if" if="[[_checkIfNotSpecified(itinerary.doors)]]">
                  <div class="icon-item">
                      <iron-icon icon="car:door"></iron-icon>
                      <span class="text">[[itinerary.doors]]</span>
                  </div>
                </template>
                
                <template is="dom-if" if="[[itinerary.airConditioning]]">
                    <div class="icon-item">
                        <iron-icon icon="car:ac"></iron-icon>
                        <span class="text">AC</span>
                    </div>
                </template>
            </div>
        </div>
        <div class="secondary-text font-12">
          <div class="section-small layout horizontal font-semi">
            <div class="primary-text font-14">Pick-up from</div>
            <div class="flex"></div>
            <div class="primary-light-text">[[pickupDate]]</div>
          </div>
          <div class="dotted-border"></div>
          <div class="section-small font-14">
              [[itinerary.pickupInfo.address]]
          </div>
          <div class="section-small layout horizontal font-semi">
              <div class="primary-text font-14">Drop-off to</div>
              <div class="flex"></div>
              <div class="primary-light-text">[[dropoffDate]]</div>
          </div>
          <div class="dotted-border"></div>
          <div class="section-small">
              <div class="margin-bottom font-14">
                [[dropoffAddress]]
              </div>
              <a class="link-style">Policy</a>
          </div>
        </div>
                
        <t-faredetails 
          id="fareDetails"
          is-collapsible
          itinerary-fare-label="Car Rental"></t-faredetails>
    </template>
    <script>
      Polymer({

          is: 't-car-payment-page',

          behaviors: [
              TravelNxt.Behaviors.DateBehavior
          ],

          observers : [
              '_onItineraryUpdate(itinerary, searchCriteria)'
          ],

          properties: {

              itinerary: {
                  type: Object
              },

              searchCriteria: {
                  type: Object
              },

/*              pickupDate: {
                  type: String
              },

              dropoffDate: {
                  type: String
              },

              pickupAddress: {
                  type: String
              },

              dropoffAddress: {
                  type: String
              }*/
          },


          _checkIfNotSpecified:  function(value){
              if(!value){
                  return false;
              }
              if (value.toLowerCase() === 'notspecified') {
                  return false;
              }
              return true;
          },

          _onItineraryUpdate: function(itinerary, searchCriteria) {
              if (!itinerary || !searchCriteria) {
                  return;
              }

              this._setDetails();

              this.$.fareDetails.data = itinerary && itinerary.fare 
                                      ? itinerary.fare.components 
                                      : null;
          },

          _setDetails: function () {
              if (!this.itinerary || !this.searchCriteria) {
                  return;
              }
              this.gear = this.itinerary.transmission.toLowerCase() === 'automatic' ? 'Auto':this.itinerary.transmission;

              this.dropoffAddress = this.itinerary.pickupInfo.address === this.itinerary.dropoffInfo.address 
                                  ? 'Same as pickup' 
                                  : this.itinerary.dropoffInfo.address;
              
              var formattedDate = this._getDateComponents(this.searchCriteria.pickupDate);
              this.pickupDate = formattedDate.date  + ' ' + formattedDate.shortMonth + ' ' + this.searchCriteria.pickupTime;
              
              formattedDate = this._getDateComponents(this.searchCriteria.dropoffDate);
              this.dropoffDate = formattedDate.date + ' ' + formattedDate.shortMonth + ' ' + this.searchCriteria.dropoffTime;

              this.$.fareDetails.baseFareLabel = 'Avg. per day rate x ' + this._dateDiff(this.pickupDate, this.dropoffDate);

          }

      });
    </script>
</dom-module>
